<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Work Projects — Thomas Watson</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        /* --- Global Styles --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --primary-blue: #0000FF; --text-primary: #212529; --text-secondary: #6c757d;
            --background: #f8f9fa; --card-background: #ffffff; --border-color: #dee2e6;
            --border-light: #e9ecef;
        }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Montserrat', sans-serif; background-color: var(--background);
            color: var(--text-primary); line-height: 1.6; padding: 40px 20px; font-weight: 300;
        }
        a { color: var(--primary-blue); text-decoration: none; font-weight: 500; transition: opacity 0.2s ease; }
        a:hover { text-decoration: none; opacity: 0.7; }

        /* --- Header & Footer --- */
        header, footer { text-align: center; max-width: 900px; margin: 0 auto; }
        header { margin-bottom: 70px; }
        h1 { font-weight: 600; font-size: 2.5rem; letter-spacing: 1px; margin-bottom: 10px; }
        footer { margin-top: 100px; padding-top: 40px; border-top: 1px solid var(--border-color); color: var(--text-secondary); font-size: 0.9rem; }
        footer p:first-child a { margin: 0 10px; }
        .back-link { font-size: 1rem; color: var(--text-secondary); display: inline-block; margin-top: 10px; transition: color 0.2s ease; }
        .back-link:hover { color: var(--primary-blue); opacity: 1; }

        /* --- Project Accordion List --- */
        .project-list { max-width: 900px; margin: 0 auto; list-style: none; }
        .project-item {
            background-color: var(--card-background); border: 1px solid var(--border-light);
            border-radius: 18px; margin-bottom: 30px; overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.06);
            transition: box-shadow 0.3s ease, margin-bottom 0.4s ease, border-color 0.4s ease, background-color 0.4s ease;
        }

        /* --- Project Preview (Clickable Header) --- */
        .project-preview {
            padding: 20px; cursor: pointer; display: flex; align-items: center; gap: 20px;
            transition: background-color 0.2s ease, opacity 0.4s ease, max-height 0.4s ease, padding 0.4s ease;
            position: relative; max-height: 200px; opacity: 1;
        }
        .project-preview:hover { background-color: #fcfcfc; }
        .project-list.item-active .project-item:not(.active) .project-preview {
            opacity: 0; max-height: 0; padding-top: 0; padding-bottom: 0;
            pointer-events: none; border-width: 0; margin-bottom: 0;
        }
        .project-list.item-active .project-item:not(.active) { margin-bottom: 0; box-shadow: none; border-color: transparent; background-color: transparent; }
        .preview-image-container { width: 100px; height: 100px; border-radius: 12px; overflow: hidden; flex-shrink: 0; position: relative; background-color: #eee; }
        .preview-image-container img { display: block; width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; opacity: 0; transition: opacity 0.8s ease-in-out; }
        .preview-image-container img.active { opacity: 1; }
        .preview-text { flex-grow: 1; position: relative; }
        .project-preview h3 { font-size: 1.25rem; font-weight: 500; margin-bottom: 5px; color: var(--text-primary); padding-right: 40px; }
        .project-preview .meta { font-size: 0.9rem; color: var(--text-secondary); font-style: italic; font-weight: 300; }

        /* --- Logo: vertically center within header preview --- */
        .preview-company-logo {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            height: 20px;
            max-width: 80px;
            opacity: 0.4;
            filter: grayscale(100%);
        }

        .preview-icon { display: inline-block; font-size: 1.5rem; color: var(--text-secondary); transition: transform 0.4s cubic-bezier(0.25, 0.1, 0.25, 1); margin-left: 15px; flex-shrink: 0; line-height: 1; transform: rotate(0deg); }
        .project-item.active .preview-icon { transform: rotate(-180deg); }

        /* --- Project Details (Hidden Content) --- */
        .project-details {
            max-height: 0; overflow: hidden;
            transition: max-height 0.6s cubic-bezier(0.4, 0, 0.2, 1), padding-top 0.6s cubic-bezier(0.4, 0, 0.2, 1), padding-bottom 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            border-top: 1px solid transparent; padding: 0 30px;
        }
        .project-item.active .project-details { max-height: 2500px; padding-top: 30px; padding-bottom: 30px; border-top-color: var(--border-light); }
        .project-description { margin-top: 30px; }
        .project-description p { margin-bottom: 15px; color: #495057; font-weight: 300; }
        .project-description strong { font-weight: 600; color: var(--primary-blue); display: block; margin-bottom: 5px; }
        .project-description p b { font-weight: 500; color: var(--text-primary); }
         .details-links { margin-top: 25px; }

        /* --- Slideshow Styles --- */
        .slideshow-container {
            position: relative;
            max-width: 100%;
            margin: 0 auto;
            overflow: hidden;
            border-radius: 12px;
            background-color: #eee;
            /* we animate height via JS for smoothness */
            transition: height 0.45s cubic-bezier(0.2,0,0.2,1);
        }
        .slide {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            opacity: 0;
            transition: opacity 0.55s ease;
            pointer-events: none;
        }
        .slide img { display: block; width: 100%; height: auto; object-fit: contain; }
        .slide.active { opacity: 1; pointer-events: auto; }
        .prev, .next { cursor: pointer; position: absolute; top: 50%; transform: translateY(-50%); width: auto; padding: 16px; color: white; font-weight: bold; font-size: 20px; background-color: rgba(0, 0, 0, 0.3); border-radius: 0 3px 3px 0; user-select: none; transition: background-color 0.3s ease; }
        .next { right: 0; border-radius: 3px 0 0 3px; }
        .prev:hover, .next:hover { background-color: rgba(0, 0, 0, 0.6); }

        /* --- Caption Styles --- */
        .caption-container { text-align: center; padding: 10px 0 5px 0; color: var(--text-secondary); font-size: 0.9rem; min-height: 1.5em; font-style: italic; transition: opacity 0.15s ease-in-out; }

        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
             body { padding: 30px 15px; } header { margin-top: 60px; } .project-preview { padding: 15px; gap: 15px; }
             .project-item.active .project-details { padding: 20px; } .preview-image-container { width: 70px; height: 70px; border-radius: 8px;}
             .project-preview h3 { font-size: 1.1rem; padding-right: 30px; } .project-preview .meta { font-size: 0.85rem;}
             .preview-company-logo { height: 16px; } .preview-icon { margin-left: 10px; font-size: 1.2rem; }
             .prev, .next { font-size: 16px; padding: 12px; } .slide img { max-height: 400px; object-fit: contain; }
        }
    </style>
</head>
<body>

    <header>
        <h1>Work Projects</h1>
        <a href="index.html" class="back-link">&larr; Back to Home</a>
    </header>

    <ul class="project-list">
        <li class="project-item" data-project-id="tesla-cell">
            <div class="project-preview">
                 <div class="preview-image-container">
                     <img src="images/tesla-cybertruck-seats.png" alt="2025 Cybertruck Seats" class="active">
                     <img src="images/robot_cell.png" alt="Example of a Fanuc robotic manufacturing cell">
                 </div>
                 <div class="preview-text">
                     <h3>Cybertruck Robotic Cell Re-Design</h3>
                     <p class="meta">Role: Equipment Design Engineering Intern @ Tesla</p>
                      <img src="images/logo-tesla.png" alt="" class="preview-company-logo">
                 </div>
                 <span class="preview-icon">›</span>
            </div>
            <div class="project-details">
                <div class="slideshow-container">
                    <div class="slide active"><img src="images/tesla-cybertruck-seats.png" alt="2025 Cybertruck Seats"></div>
                    <div class="slide"><img src="images/robot_cell.png" alt="Example of a Fanuc robotic manufacturing cell"></div>
                    <a class="prev" onclick="manualSlideChange('tesla-cell', -1)">&#10094;</a>
                    <a class="next" onclick="manualSlideChange('tesla-cell', 1)">&#10095;</a>
                </div>
                <div class="caption-container"></div>
                <div class="project-description">
                    <p><strong>Problem:</strong> A key robotic cell on the Cybertruck production line was improperly disposing of rejected seat structures, dropping them on the floor. This resulted in hundreds of thousands of dollars in annual material scrap, frequent production downtime for manual retrieval, and created a safety hazard for associates entering the cell.</p>
                    <p><strong>My Solution:</strong> As the sole owner of this project, I engineered a complete mechanical and robotics solution. I designed a custom, non-intrusive rejection chute from the ground up using Solidworks and Siemens NX, ensuring it integrated seamlessly into the existing cell's tight footprint. I then single-handedly reprogrammed the entire Fanuc robotic logic, rewriting the pathing to flawlessly deposit rejected parts into the new assembly.</p>
                    <p><strong>Results:</strong> I drove the project through the full lifecycle, leading a cross-functional team of stakeholders from manufacturing, compliance, and testing to successfully implement my design. The solution completely eliminated the scrap issue and associated downtime, delivering an annual savings of <b>over $175,000</b> while improving cell safety and maintaining the original workflow for production associates.</p>
                </div>
            </div>
        </li>

        <li class="project-item" data-project-id="lm-integration">
            <div class="project-preview">
                 <div class="preview-image-container">
                     <img src="images/lockheed-system-integration.png" alt="CSC Ship Rendering by Mechanical Design Team" class="active">
                     <img src="images/laser_photo.png" alt="Unclassified Example: Similar Laser Warning System">
                     <img src="images/laser_3.png" alt="Unclassified Example: Similar System Integration">
                  </div>
                <div class="preview-text">
                    <h3>Advanced Classified System Design TPM</h3>
                    <p class="meta">Role: Mechanical Design TPM Intern @ Lockheed Martin</p>
                    <img src="images/logo-lockheed.png" alt="" class="preview-company-logo">
                </div>
                <span class="preview-icon">›</span>
            </div>
            <div class="project-details">
                 <div class="slideshow-container">
                     <div class="slide active"><img src="images/lockheed-system-integration.png" alt="CSC Ship Rendering by Mechanical Design Team"></div>
                     <div class="slide"><img src="images/laser_photo.png" alt="Unclassified Example: Similar Laser Warning System"></div>
                     <div class="slide"><img src="images/laser_3.png" alt="Unclassified Example: Similar System Integration"></div>
                     <a class="prev" onclick="manualSlideChange('lm-integration', -1)">&#10094;</a>
                     <a class="next" onclick="manualSlideChange('lm-integration', 1)">&#10095;</a>
                 </div>
                 <div class="caption-container"></div>
                 <div class="project-description">
                     <p><strong>Problem:</strong> Tasked as the integration lead for a proprietary, mission-critical system on the CSC, I was responsible for navigating conflicting constraints from external vendors and internal RF, electrical, structural, and mechanical design teams. The challenge was to find a viable integration path that did not compromise system performance, ship layout, or classified design integrity, including necessitating <b>redesign of sections of the ship's hull</b>.</p>
                     <p><strong>My Solution:</strong> I took extreme ownership, serving as the single point of contact between <b>4 key vendors and internal cross-functional teams</b>. Leveraging my security clearance which vendors lacked, I <b>personally took the initiative</b> to drive the technical design iterations within the classified environment. Using SolidWorks, I modeled and proposed design changes to resolve complex physical, thermal, and RF constraints, and <b>led the hull redesign effort</b> collaborating with the internal mechanical team and the primary structural vendor. My key responsibility was distilling highly technical, classified requirements into actionable, unclassified tasks for vendors.</p>
                     <p><strong>Results:</strong> By <b>leading the integration and design iterations with vendors and presenting solutions to upper management</b>, I successfully aligned all stakeholders on a final, approved integration path, including the necessary hull modifications. This cleared a major bottleneck for a critical program milestone, ensuring the project remained on schedule while meeting all system requirements within a secure framework.</p>
                 </div>
            </div>
        </li>

         <li class="project-item" data-project-id="lm-topside">
            <div class="project-preview">
                 <div class="preview-image-container">
                      <img src="images/lockheed-topside-design.png" alt="CAD rendering of naval ship topside equipment layout" class="active">
                      <img src="images/LOS.png" alt="SolidWorks Line-of-Sight (LOS) dome analysis tool">
                      <img src="images/rf_pattern.png" alt="Example RF antenna pattern analysis consideration">
                 </div>
                <div class="preview-text">
                     <h3>CSC Topside Mechanical Design & Integration</h3>
                    <p class="meta">Role: Mechanical Design TPM Intern @ Lockheed Martin</p>
                    <img src="images/logo-lockheed.png" alt="" class="preview-company-logo">
                </div>
                 <span class="preview-icon">›</span>
            </div>
            <div class="project-details">
                <div class="slideshow-container">
                    <div class="slide active"><img src="images/lockheed-topside-design.png" alt="CAD rendering of naval ship topside equipment layout"></div>
                    <div class="slide"><img src="images/LOS.png" alt="SolidWorks Line-of-Sight (LOS) dome analysis tool"></div>
                     <div class="slide"><img src="images/rf_pattern.png" alt="Example RF antenna pattern analysis consideration"></div>
                    <a class="prev" onclick="manualSlideChange('lm-topside', -1)">&#10094;</a>
                    <a class="next" onclick="manualSlideChange('lm-topside', 1)">&#10095;</a>
                </div>
                <div class="caption-container"></div>
                <div class="project-description">
                    <p><strong>Problem:</strong> Relocating critical topside equipment on the CSC required complex mechanical integration solutions to satisfy competing constraints from RF performance, thermal loads, structural integrity, aerodynamic factors, and vendor specifications. Failure to find mechanically sound placements would impact system functionality and project timelines.</p>
                    <p><strong>My Solution:</strong> I led the mechanical design effort for several key equipment placements. This involved creating detailed feasibility studies and 3D models in SolidWorks, utilizing tools like Line-of-Sight analysis to evaluate integration options against all constraints. I collaborated closely with internal RF, Thermal, and Aero analysis teams to incorporate their findings into the mechanical designs, and worked directly with equipment vendors to ensure mechanical compatibility. I then presented the technical trade-offs and <b>proposed recommended solutions to senior management</b>.</p>
                    <p><strong>Results:</strong> My mechanical design analyses and cross-functional leadership resulted in the successful approval and implementation path for <b>9 critical equipment placements</b> within 4 months. This work ensured the mechanical integrity and functional performance of the topside systems while balancing complex interdisciplinary requirements.</p>
                </div>
                 <div class="details-links">
                     <a href="images/Mech_Design_Lockheed_TW.pdf" target="_blank">View Project Context PDF</a>
                 </div>
            </div>
        </li>

        <li class="project-item" data-project-id="lm-cfd">
            <div class="project-preview">
                 <div class="preview-image-container">
                      <img src="images/lockheed-cfd.png" alt="CFD thermal analysis of helicopter landing deck" class="active">
                      <img src="images/cfd_calc.png" alt="Thermodynamic calculation method for mass flow rate">
                      <img src="images/cfd_ship.png" alt="Unclassified example of aerodynamic headwind simulation">
                 </div>
                 <div class="preview-text">
                    <h3>Helicopter Landing Thermal Analysis (CFD)</h3>
                    <p class="meta">Role: Aerodynamics/RF Engineering Intern @ Lockheed Martin</L>
                    <img src="images/logo-lockheed.png" alt="" class="preview-company-logo">
                 </div>
                <span class="preview-icon">›</span>
            </div>
            <div class="project-details">
                <div class="slideshow-container">
                    <div class="slide active"><img src="images/lockheed-cfd.png" alt="CFD thermal analysis of helicopter landing deck"></div>
                    <div class="slide"><img src="images/cfd_calc.png" alt="Thermodynamic calculation method for mass flow rate"></div>
                    <div class="slide"><img src="images/cfd_ship.png" alt="Unclassified example of aerodynamic headwind simulation"></div>
                    <a class="prev" onclick="manualSlideChange('lm-cfd', -1)">&#10094;</a>
                    <a class="next" onclick="manualSlideChange('lm-cfd', 1)">&#10095;</a>
                </div>
                <div class="caption-container"></div>
                <div class="project-description">
                     <p><strong>Problem:</strong> The Canadian Surface Combatant (CSC) program needed to validate safe helicopter landing conditions, but it was unknown how hot turbine exhaust would affect the flight deck under dozens of different headwind angles, engine throttles, and outtake arrangements. The team lacked the critical thermal data required for RANS/LES simulations.</p>
                     <p><strong>My Solution:</strong> I <b>developed the foundational thermodynamic model</b> to solve this problem. I first <b>calculated the previously unknown engine exhaust mass flow rates and temperatures</b> for all required scenarios, working with vendors to establish proper power distribution. Using this data, I <b>developed, meshed, and analyzed over 20 CSC ship model iterations</b> in ANSYS Fluent to model all combinations of headwind angles and engine uptake conditions. I also collaborated with the RF team on antenna coupling analyses.</p>
                     <p><strong>Results:</strong> My simulations generated thermal contour maps showing the maximum temperature over the flight deck for every possible condition. I <b>consolidated this complex data into a single, concise 'logic board'</b> that was delivered to vendors, enabling them to validate safe helicopter landing envelopes for the multi-billion dollar program.</p>
                </div>
                 <div class="details-links">
                     <a href="images/lockheed_project.pdf" target="_blank">View Project Context PDF</a>
                 </div>
            </div>
        </li>

         <li class="project-item" data-project-id="lm-los">
             <div class="project-preview">
                 <div class="preview-image-container">
                    <img src="images/lockheed-los-analysis.png" alt="Line-of-sight analysis diagram for naval ship" class="active">
                      <img src="images/los_discrepancy.png" alt="Diagram showing LOS analysis discrepancy">
                 </div>
                 <div class="preview-text">
                     <h3>Company-Wide Line-of-Sight (LOS) Process Overhaul</h3>
                      <p class="meta">Role: Mechanical Design TPM Intern @ Lockheed Martin</p>
                      <img src="images/logo-lockheed.png" alt="" class="preview-company-logo">
                 </div>
                  <span class="preview-icon">›</span>
               </div>
               <div class="project-details">
                 <div class="slideshow-container">
                     <div class="slide active"><img src="images/lockheed-los-analysis.png" alt="Line-of-sight analysis diagram for naval ship"></div>
                      <div class="slide"><img src="images/los_discrepancy.png" alt="Diagram showing LOS analysis discrepancy"></div>
                      <a class="prev" onclick="manualSlideChange('lm-los', -1)">&#10094;</a>
                      <a class="next" onclick="manualSlideChange('lm-los', 1)">&#10095;</a>
                 </div>
                 <div class="caption-container"></div>
                 <div class="project-description">
                      <p><strong>Problem:</strong> The existing company procedure for conducting line-of-sight (LOS) analysis for critical topside equipment on the Canadian Surface Combatant (CSC) program contained significant discrepancies, leading to inaccurate results and potential rework.</p>
                      <p><strong>My Solution:</strong> After identifying the root cause of the errors, I led the complete redevelopment of a new, more accurate LOS analysis procedure using SolidWorks. I created all documentation for the new standard and personally trained other engineers on its proper implementation to ensure company-wide adoption.</p>
                      <p><strong>Results:</strong> The new procedure I developed was formally adopted and improved process accuracy by <b>over 8%</b>. This enhancement reduced the risk of costly design flaws and is now the standard method used for the multi-billion dollar CSC program.</p>
                 </div>
            </div>
        </li>

        <li class="project-item" data-project-id="rtx-auto">
             <div class="project-preview">
                 <div class="preview-image-container">
                      <img src="images/powerbi.png" alt="Data flow: Python to VBA to Power BI" class="active">
                      <img src="images/rtx-automation.png" alt="Process automation flowchart for SAP data extraction">
                      <img src="images/sap-screenshot.png" alt="Example SAP Interface">
                 </div>
                 <div class="preview-text">
                    <h3>PW800 Manufacturing Automation Dashboard</h3>
                    <p class="meta">Role: Aerospace Engineering and Logistics Intern @ RTX (Pratt & Whitney)</p>
                      <img src="images/logo-rtx.png" alt="" class="preview-company-logo">
                 </div>
                  <span class="preview-icon">›</span>
               </div>
            <div class="project-details">
                 <div class="slideshow-container">
                      <div class="slide active"><img src="images/powerbi.png" alt="Data flow: Python to VBA to Power BI"></div>
                     <div class="slide"><img src="images/rtx-automation.png" alt="Process automation flowchart for SAP data extraction"></div>
                     <a class="prev" onclick="manualSlideChange('rtx-auto', -1)">&#10094;</a>
                     <a class="next" onclick="manualSlideChange('rtx-auto', 1)">&#10095;</a>
                 </div>
                 <div class="caption-container"></div>
                 <div class="project-description">
                     <p><strong>Problem:</strong> Strategic decisions for the PW800 production line were hindered by outdated Python scripts with a non-technical (Jupyter Notebook) UI. This made vital manufacturing metrics from SAP inaccessible to robotics technicians and leadership, forcing a slow, manual data-pulling process that took <b>8 hours every week</b> and was prone to errors.</p>
                     <p><strong>My Solution:</strong> I took the initiative to re-engineer the entire process. I <b>translated the core logic from the legacy Python scripts into robust VBA macros</b>, embedding them directly into Excel. This allowed technicians to run complex data queries from SAP by simply clicking a button. I then connected these automated Excel files to a <b>Power BI frontend</b>, creating an intuitive, user-friendly dashboard that updated automatically.</p>
                     <p><strong>Results:</strong> The new system completely eliminated the manual data refresh process and provided live, accurate metrics to all stakeholders. The tool was adopted <b>company-wide by 5 cross-functional teams</b> (Engineering, Quality, Logistics, Technicians, and Leadership), making critical production data accessible for the first time and serving as the new baseline for strategic optimization.</p>
                 </div>
            </div>
        </li>
    </ul>

    <footer>
        <p>
            <a href="images/resume.pdf" target="_blank"> Download Resume</a> ·
            <a href="mailto:thomaswatson1188@gmail.com">Email Me</a> ·
            <a href="https://linkedin.com/in/thomaswatsonn" target="_blank">LinkedIn</a>
        </p>
        <p>© 2025 Thomas Watson</p>
    </footer>

    <script>
        // --- Accordion Logic & Slideshow Data ---
        const projectItems = Array.from(document.querySelectorAll('.project-item'));
        const slideshowData = {};
        const previewSlideshowData = {};

        // --- Utilities: wait for image to be ready ---
        function waitForImageLoad(img, timeout = 4000) {
            return new Promise(resolve => {
                if (!img) return resolve();
                // If already loaded
                if (img.complete && img.naturalWidth) return resolve();
                const onDone = () => {
                    img.removeEventListener('load', onDone);
                    img.removeEventListener('error', onDone);
                    resolve();
                };
                img.addEventListener('load', onDone);
                img.addEventListener('error', onDone);
                // fallback
                setTimeout(() => {
                    img.removeEventListener('load', onDone);
                    img.removeEventListener('error', onDone);
                    resolve();
                }, timeout);
            });
        }

        // --- compute pixel height for container to preserve natural aspect ratio (no crop) ---
        function computeHeightForImage(container, img) {
            if (!container || !img) return 300;
            const naturalW = img.naturalWidth || img.width || 1;
            const naturalH = img.naturalHeight || img.height || 1;
            const width = container.clientWidth || container.offsetWidth || 600;
            if (naturalW && naturalH) {
                return Math.max(120, Math.round(width * naturalH / naturalW));
            }
            // fallback to current rendered height
            try {
                const rect = img.getBoundingClientRect();
                if (rect && rect.height > 0) return rect.height;
            } catch (e) {}
            return Math.max(120, Math.round(width * 0.6));
        }

        // --- keep per-container ResizeObserver to update height responsively while open ---
        const resizeObservers = new Map();
        function attachResizeObserver(container, activeImg, projectId) {
            if (!container) return;
            // already attached?
            if (resizeObservers.has(container)) return;
            const ro = new ResizeObserver(() => {
                // only adjust if open / has active slide
                const data = slideshowData[projectId];
                if (!data) return;
                // pick active slide img
                const active = container.querySelector('.slide.active img') || activeImg;
                if (!active) return;
                const h = computeHeightForImage(container, active);
                container.style.height = h + 'px';
            });
            ro.observe(container);
            resizeObservers.set(container, ro);
        }
        function detachResizeObserver(container) {
            const ro = resizeObservers.get(container);
            if (ro) {
                try { ro.disconnect(); } catch(e){}
                resizeObservers.delete(container);
            }
        }

        // --- Initialize Data ---
        function initializeSlideshow(projectId) {
            if (!slideshowData[projectId]) {
                const projectItem = document.querySelector(`.project-item[data-project-id="${projectId}"]`);
                const slides = Array.from(projectItem.querySelectorAll('.project-details .slide'));
                const captions = slides.map(slide => {
                    const img = slide.querySelector('img');
                    return img ? (img.alt || '') : '';
                });
                slideshowData[projectId] = {
                    slideIndex: 0,
                    slides: slides,
                    captions: captions,
                    timer: null,
                    captionElement: projectItem.querySelector('.project-details .caption-container'),
                    containerElement: projectItem.querySelector('.slideshow-container'),
                    projectItem: projectItem
                };
            }
        }
        function initializePreviewSlideshow(projectId) {
            if (!previewSlideshowData[projectId]) {
                const projectItem = document.querySelector(`.project-item[data-project-id="${projectId}"]`);
                const previewContainer = projectItem.querySelector('.preview-image-container');
                const previewImages = Array.from(previewContainer.querySelectorAll('img'));
                previewSlideshowData[projectId] = {
                    previewIndex: 0, previewImages: previewImages, previewTimer: null
                };
            }
        }

        // --- Preview small image slideshow ---
        function showPreviewImage(projectId, index) {
             initializePreviewSlideshow(projectId);
             const data = previewSlideshowData[projectId];
             if (!data || !data.previewImages || data.previewImages.length === 0) return;
             if (index >= data.previewImages.length) { index = 0; }
             if (index < 0) { index = data.previewImages.length - 1; }
             data.previewImages.forEach(img => img.classList.remove('active'));
             data.previewImages[index].classList.add('active');
             data.previewIndex = index;
        }
        function startPreviewAutoSlide(projectId) {
             initializePreviewSlideshow(projectId);
             const data = previewSlideshowData[projectId];
             if (!data || data.previewImages.length <= 1) return;
             stopPreviewAutoSlide(projectId);
             showPreviewImage(projectId, 0); // Start immediately
             data.previewTimer = setInterval(() => { showPreviewImage(projectId, data.previewIndex + 1); }, 3000);
        }
        function stopPreviewAutoSlide(projectId) {
             if (previewSlideshowData[projectId] && previewSlideshowData[projectId].previewTimer) {
                 clearInterval(previewSlideshowData[projectId].previewTimer);
                 previewSlideshowData[projectId].previewTimer = null;
             }
        }

        // --- Show a main slideshow slide (smooth, waits for image) ---
        function showSlide(projectId, index) {
            initializeSlideshow(projectId);
            const data = slideshowData[projectId];
            if (!data || !data.slides || data.slides.length === 0) return;
            if (index >= data.slides.length) index = 0;
            if (index < 0) index = data.slides.length - 1;

            // if same slide requested, update caption only
            if (data.slideIndex === index) {
                if (data.captionElement) {
                    data.captionElement.style.opacity = 0;
                    setTimeout(() => {
                        data.captionElement.textContent = data.captions[index] || '';
                        data.captionElement.style.opacity = 1;
                    }, 150);
                }
                return;
            }

            const targetSlide = data.slides[index];
            const targetImg = targetSlide.querySelector('img');

            // Stop preview animation for safety
            stopPreviewAutoSlide(projectId);

            // ensure target image loaded (avoid blank)
            return waitForImageLoad(targetImg, 4000).then(() => {
                // compute the height we will animate to
                const container = data.containerElement;
                const targetHeight = computeHeightForImage(container, targetImg);

                // set explicit pixel height to animate to; do not set to '' yet
                // (we'll keep explicit height while open so layout is stable)
                container.style.height = targetHeight + 'px';

                // force a reflow so height change registers
                container.getBoundingClientRect();

                // remove active from others and add to target with rAF so opacity transition triggers
                data.slides.forEach(s => s.classList.remove('active'));
                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        targetSlide.classList.add('active');
                        data.slideIndex = index;
                        if (data.captionElement) {
                            data.captionElement.style.opacity = 0;
                            setTimeout(() => {
                                data.captionElement.textContent = data.captions[index] || '';
                                data.captionElement.style.opacity = 1;
                            }, 150);
                        }
                    });
                });

                // attach ResizeObserver to keep height responsive while open
                attachResizeObserver(container, targetImg, projectId);

                // return resolved promise for calling code
                return Promise.resolve();
            });
        }

        function manualSlideChange(projectId, n) {
             initializeSlideshow(projectId);
             const data = slideshowData[projectId];
             stopAutoSlide(projectId); // Stop main timer
             // call showSlide and when it finishes, restart auto after delay
             Promise.resolve(showSlide(projectId, data.slideIndex + n)).then(() => {
                 setTimeout(() => startAutoSlide(projectId), 8000);
             });
         }
        function startAutoSlide(projectId) {
             initializeSlideshow(projectId);
            const data = slideshowData[projectId];
            if (!data || data.slides.length <= 1) return;
            stopAutoSlide(projectId);
             data.timer = setInterval(() => {
                 showSlide(projectId, data.slideIndex + 1);
            }, 5000);
        }
        function stopAutoSlide(projectId) {
            if (slideshowData[projectId] && slideshowData[projectId].timer) {
                 clearInterval(slideshowData[projectId].timer);
                 slideshowData[projectId].timer = null;
            }
        }

        // animate container collapse (promise-based)
        function animateHeightTo(container, fromPx, toPx, timeout = 650) {
            return new Promise(resolve => {
                if (!container) return resolve();
                let done = false;
                const onEnd = (e) => {
                    if (e && e.target !== container) return;
                    if (done) return;
                    done = true;
                    container.removeEventListener('transitionend', onEnd);
                    resolve();
                };
                container.addEventListener('transitionend', onEnd);
                // set start
                container.style.height = fromPx + 'px';
                // force reflow
                container.getBoundingClientRect();
                // animate to
                requestAnimationFrame(() => {
                    container.style.height = toPx + 'px';
                });
                // fallback
                setTimeout(() => { if (!done) { done = true; container.removeEventListener('transitionend', onEnd); resolve(); } }, timeout + 100);
            });
        }

        // --- Accordion Click Handler: open/close sequence robustly ---
        projectItems.forEach(item => {
            const summary = item.querySelector('.project-preview');
            const projectId = item.getAttribute('data-project-id');

            // start small preview auto-slideshow
            startPreviewAutoSlide(projectId);

            summary.addEventListener('click', async () => {
                const wasActive = item.classList.contains('active');
                const list = item.closest('.project-list');

                // Close others first (animate their collapse)
                for (const otherItem of projectItems) {
                    if (otherItem !== item && otherItem.classList.contains('active')) {
                        const otherId = otherItem.getAttribute('data-project-id');
                        otherItem.classList.remove('active');
                        const otherData = slideshowData[otherId];
                        // stop large slideshow
                        if (otherData) stopAutoSlide(otherId);
                        // animate collapse of its container if present
                        const otherContainer = otherItem.querySelector('.slideshow-container');
                        if (otherContainer) {
                            otherItem.classList.add('closing');
                            // ensure explicit height exists
                            const curH = otherContainer.getBoundingClientRect().height || otherContainer.clientHeight || 0;
                            // animate to 0
                            await animateHeightTo(otherContainer, curH, 0);
                            // cleanup
                            otherContainer.style.height = '';
                            otherItem.classList.remove('closing');
                            detachResizeObserver(otherContainer);
                        }
                        startPreviewAutoSlide(otherId);
                    }
                }

                // toggle current item
                if (!wasActive) { // opening sequence
                    item.classList.add('active');
                    list.classList.add('item-active');
                    initializeSlideshow(projectId);
                    stopPreviewAutoSlide(projectId);

                    const data = slideshowData[projectId];
                    const container = data.containerElement;

                    // compute initial height for current (or first) slide
                    const initialSlide = container.querySelector('.slide') || data.slides[0];
                    const initialImg = initialSlide ? initialSlide.querySelector('img') : null;

                    // wait for image load and then set/animate height to that image's height
                    if (initialImg) await waitForImageLoad(initialImg, 4000);
                    const targetH = computeHeightForImage(container, initialImg || container.querySelector('img'));
                    // animate from 0 to target
                    await animateHeightTo(container, 0, targetH);

                    // show first slide (ensures caption updated and opacity fade)
                    await showSlide(projectId, 0);
                    // start auto rotating large slides
                    startAutoSlide(projectId);
                } else { // closing sequence
                    // ensure we keep the slide visible until collapse ends to prevent description peeking
                    const data = slideshowData[projectId];
                    const container = data ? data.containerElement : (item.querySelector('.slideshow-container'));
                    if (container) {
                        item.classList.add('closing');
                        stopAutoSlide(projectId);
                        // compute current pixel height to animate from
                        const curH = container.getBoundingClientRect().height || container.clientHeight || 0;
                        await animateHeightTo(container, curH, 0);
                        container.style.height = '';
                        item.classList.remove('closing');
                        detachResizeObserver(container);
                    }
                    item.classList.remove('active');
                    list.classList.remove('item-active');
                    startPreviewAutoSlide(projectId);
                }
            });
        });

        // Add transition to caption container CSS
         const styleSheet = document.styleSheets[0];
         try {
             styleSheet.insertRule('.caption-container { transition: opacity 0.15s ease-in-out; }', styleSheet.cssRules.length);
             styleSheet.insertRule('.project-list.item-active .project-item:not(.active) { transition: opacity 0.4s ease, max-height 0.4s ease, margin-bottom 0.4s ease, border-color 0.4s ease, background-color 0.4s ease, box-shadow 0.4s ease; }', styleSheet.cssRules.length);
         } catch (e) { /* ignore insertion errors */ }

        // --- NEW: Open specific project on page load if hash or ?project= is present ---
        (function openProjectFromURL() {
            try {
                const hashId = window.location.hash ? decodeURIComponent(window.location.hash.substring(1)) : '';
                const params = new URLSearchParams(window.location.search);
                const projParam = params.get('project') ? decodeURIComponent(params.get('project')) : '';
                const targetId = hashId || projParam;
                if (!targetId) return;

                const targetPreview = document.querySelector(`.project-item[data-project-id="${targetId}"] .project-preview`);
                if (targetPreview) {
                    setTimeout(() => {
                        targetPreview.click();
                        try { targetPreview.scrollIntoView({ behavior: 'smooth', block: 'center' }); } catch (e) {}
                    }, 180);
                }
            } catch (e) { console.error('openProjectFromURL error:', e); }
        })();

        // small defensive: start preview timers for items that may not have been initialized above
        projectItems.forEach(p => {
            const id = p.getAttribute('data-project-id');
            if (!previewSlideshowData[id] || !previewSlideshowData[id].previewTimer) startPreviewAutoSlide(id);
        });

    </script>

</body>
</html>
